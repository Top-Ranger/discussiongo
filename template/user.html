<!DOCTYPE HTML>
<html lang="de">

<head>
  <title>{{if .ForumName}}{{.ForumName}} - {{end}}DiscussionGo!</title>
  <meta charset="UTF-8">
  <meta name="robots" content="noindex, nofollow"/>
  <meta name="author" content="Marcus Soll"/>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="author" href="https://msoll.de/">
  <link rel="stylesheet" href="{{.ServerPath}}/css/discussiongo.css">
  <link rel="icon" type="image/vnd.microsoft.icon" href="{{.ServerPath}}/static/favicon.ico">
</head>

<body>
  <header>
    <div style="margin-left: 1%">
      {{if .ForumName}}{{.ForumName}} - {{end}}DiscussionGo!
    </div>
  </header>

  <script>
    var stopClosingWindow = true;
    var contentChanged = false;

    window.addEventListener('beforeunload', function (e) {
      var ta = document.getElementById("textarea");
      if(contentChanged && stopClosingWindow && ta !== null && ta.value != "{{.CommentUnescaped}}"){
        e.preventDefault();
        e.returnValue = '';
      }
    });
  </script>

  <div>
    <h1><a href="{{.ServerPath}}/">Zurück</a></h1>
  </div>

  <div>
      <h1>Benutzer</h1>
      <p>Name: {{.User}}</p>
      {{if .IsAdmin}}<p><strong>Benutzer ist Administrator</strong></p>{{end}}
      <p>Letzte Aktivität: <i>{{.LastSeen}}</i></p>
      <p><a href="{{.ServerPath}}/profile.html?user={{.User}}">Öffentliches Profil</a></p>
      <p><a href="{{.ServerPath}}/login.html">Logout</a></p>

      <h1 id="comment">Kommentar</h1>
      <script>
        function showPreview() {
          var ta = document.getElementById("textarea")
          if(ta.value.length == 0) {
            var preview = document.getElementById("preview")
            preview.innerHTML = ""
            return
          }
          var form = new FormData();
          form.append("post", ta.value);
          form.append("token", "{{.Token}}");
          var xhr = new XMLHttpRequest();
          xhr.open("POST", "{{$.ServerPath}}/getFormattedPost/", true);
          xhr.onload = function() {
            var preview = document.getElementById("preview")
            preview.innerHTML = xhr.response
          }
          xhr.send(form);
        }
      </script>
      {{if .HasComment}}
      <p>Momentan:</p>
      <div class="comment">
        {{.Comment}}
      </div>
      {{end}}
      <div id="preview"></div>
      <p><button onclick="showPreview();">Vorschau</button></p>  
      <form id="changeComment" action="{{.ServerPath}}/comment.html" method="POST">
        <input type="hidden" name="token" value="{{.Token}}">
        <textarea id="textarea" name="comment" rows="5" form="changeComment" placeholder="Neuer Kommentar" maxlength="10000" onchange="contentChanged = true;">{{.CommentUnescaped}}</textarea> <br>
        <input type="submit" id="commentSubmitButton" value="Kommentar ändern" onclick="stopClosingWindow = false;">
      </form>

      <form id="changePassword" action="{{.ServerPath}}/password.html" method="POST">
        <input type="hidden" name="token" value="{{.Token}}">
        <h1>Passwort ändern</h1>
        <label for="old">Altes Passwort:</label> <br>
        <input id="old" type="password" name="old" placeholder="Altes Passwort" required> <br>
        <label for="new">Neues Passwort:</label> <br>
        <input id="new" type="password" name="new" placeholder="Neues Passwort" required> <br>
        <input type="submit" id="submitButton" value="Passwort ändern">
      </form>
  </div>

  {{if .CanInvite}}
  <div id="inv">
      <h1>Einladungen</h1>
      <p>Offene Einladungen:</p>
      <ul>
      {{range $i, $e := .Invitations }}
        <li>{{$.ServerPrefix}}/invitation.html?inv={{$e}}<p><button onclick="document.getElementById('deleteInv{{$e}}').removeAttribute('hidden'); this.disabled=true">Einladung löschen</button></p><p id="deleteInv{{$e}}" hidden><a href="{{$.ServerPath}}/deleteInvitation.html?id={{$e}}&token={{$.Token}}">Einladung löschen</a></p></li>
      {{end}}
      </ul>
    {{if .CreateInvitationMessage}}<p><i>{{.CreateInvitationMessage}}</i></p>{{end}}
    <form id="newInvitation" action="{{.ServerPath}}/newInvitation.html" method="POST">
      <input type="hidden" name="token" value="{{.Token}}">
      <input type="submit" id="submitButton" value="Neue Einladung">
    </form>
  </div>
  {{end}}

  <div>
    <h1>Alle Daten exportieren</h1>
    <p><a href="{{$.ServerPath}}/dsgvoExport.xml?token={{.Token}}" download="export_{{.User}}.xml">Alle gespeicherten Daten exportieren (gemäß DSGVO Art. 15 und DSGVO Art. 20)</a></p>
  </div>

  <div>
    <h1>Nutzer löschen</h1>
    <p><button onclick="document.getElementById('deleteLink').removeAttribute('hidden'); this.disabled=true">Benutzer löschen</button></p>
    <p id="deleteLink" hidden><a href="{{$.ServerPath}}/deleteUser.html?user={{.User}}&token={{.Token}}">Benutzer JETZT löschen (kann nicht rückgängig gemacht werden)</a></p>
  </div>

  <div>
    <h1><a href="{{.ServerPath}}/">Zurück</a></h1>
  </div>

  <footer>
    <div>
      Created by <a href="https://msoll.de/"><u>Marcus Soll</u></a> - <a href="{{.ServerPath}}/impressum.html"><u>Impressum</u></a> - <a href="{{.ServerPath}}/datenschutz.html"><u>Datenschutzerklärung</u></a>
    </div>
  </footer>
</body>

</html>